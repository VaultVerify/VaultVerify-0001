<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Community verification request form</title>
  <style>
    :root{
      --bg:#fffaf0; --card:#ffffff; --accent:#10b981; --accent-2:#06b6d4;
      --muted:#6b7280; --radius:14px; --maxw:780px;
    }
    html,body{height:100%}

    /* Top banner with thumbnail + badge */
    .top-banner {
      display: flex;
      align-items: center;
      justify-content: flex-start;
      gap: 12px;
      background: rgba(0,0,0,0.6);
      color: white;
      padding: 10px 16px;
      border-radius: 12px;
      margin-bottom: 18px;
      max-width: var(--maxw);
      width: 100%;
      box-sizing: border-box;
    }

    /* logo as image thumbnail */
    .logo {
      width: 42px;
      height: 42px;
      border-radius: 10px;
      object-fit: cover;
      box-shadow: 0 6px 20px rgba(6,182,212,0.12);
      flex: 0 0 42px;
    }

    .badge {
      background: #dc2626;
      color: white;
      font-weight: 700;
      font-size: 14px;
      padding: 6px 12px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      white-space: nowrap;
    }

    /* Page background (flag) and layout */
    body {
      margin: 0;
      font-family: Inter, system-ui, Segoe UI, Roboto, Arial;
      background: url('american-flag-backgrounds-free-photo.jpg') center center / cover no-repeat fixed;
      color: #0f172a;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 28px;
      box-sizing: border-box;
    }

    .wrap {
      width: 100%;
      max-width: var(--maxw);
      padding: 18px;
      box-sizing: border-box;
    }

    /* Form card with eagle image and semi-transparent overlay */
    .card {
      background: url('Screenshot_20210525_015028_Discord.jpg') center center / cover no-repeat;
      border-radius: var(--radius);
      box-shadow: 0 12px 40px rgba(2,6,23,0.08);
      padding: 22px;
      display: grid;
      gap: 16px;
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: "";
      position: absolute;
      inset: 0;
      background: rgba(255,255,255,0.85);
      border-radius: var(--radius);
      z-index: 0;
    }

    .card > * {
      position: relative;
      z-index: 1;
    }

    .header {
      display: flex;
      gap: 14px;
      align-items: center;
      justify-content: space-between;
    }

    /* Title / copy */
    h1{font-size:20px; margin:0; line-height:1.05}
    p.lead{margin:0; color:var(--muted); font-size:13.5px}

    /* Form styles */
    form{display:grid; gap:12px; margin-top:2px}
    label{font-size:13px; color:#0f172a}
    input[type="text"]{
      width:100%; padding:12px 14px; border-radius:10px; border:1px solid #e6eef0;
      background:transparent; font-size:15px; box-sizing:border-box; outline:none;
      transition:box-shadow .12s, border-color .12s;
    }
    input[type="text"]:focus{border-color:var(--accent-2); box-shadow:0 6px 20px rgba(6,182,212,0.08)}
    .row{display:flex; gap:12px}
    .btn{
      background:linear-gradient(90deg,var(--accent),var(--accent-2)); color:white; border:0;
      padding:12px 16px; border-radius:10px; cursor:pointer; font-weight:700; font-size:15px;
      box-shadow:0 10px 30px rgba(16,185,129,0.12);
    }
    .btn:disabled{opacity:0.6; cursor:not-allowed}
    .muted{color:var(--muted); font-size:13px}
    #status{margin-top:6px; font-size:14px}
    .meta{display:flex; gap:8px; align-items:center; margin-top:6px; font-size:13px; color:var(--muted)}
    footer.note{margin-top:6px; font-size:13px; color:var(--muted)}

    @media (max-width:520px){
      .row{flex-direction:column}
      .header{gap:10px}
      .top-banner{padding:10px}
      .badge{font-size:13px; padding:6px 10px}
    }
  </style>
</head>
<body>
  <!-- Top banner: thumbnail + badge -->
  <div class="top-banner" role="banner" aria-label="Site header">
    <img src="Screenshot_20251025_015028_Discord.jpg" alt="Thumbnail" class="logo" />
    <div class="badge">Michigan Idiots</div>
  </div>

  <div class="wrap">
    <div class="card" role="region" aria-label="Community verification request">
      <div class="header">
        <div style="flex-grow:1">
          <h1>Community verification request form</h1>
          <p class="lead">Submit your Discord handle and region. Allow location for verification completion.</p>
        </div>
      </div>

      <form id="verifyForm" autocomplete="off" novalidate>
        <label for="discord">Discord username</label>
        <input id="discord" name="discord" type="text" required placeholder="Name#1234" />

        <label for="claimed">Claimed state or region</label>
        <input id="claimed" name="claimed" type="text" required placeholder="Michigan" />

        <div class="meta">No IP stored, no data collection logged, and no pictures needed for basic user verification.</div>

        <div style="height:8px"></div>

        <div class="row" style="justify-content:space-between; align-items:center">
          <div class="muted" aria-hidden="true">FURTHER VERIFICATION MAY BE REQUESTED</div>
          <button class="btn" id="submitBtn" type="submit">Submit</button>
        </div>
      </form>

      <div id="status" aria-live="polite" class="muted"></div>
      <footer class="note">Results are heuristic. If you want faster review, notify server admins after submitting.</footer>
    </div>
  </div>

  <script>
    // Google Form POST endpoint and entry IDs from your prefill link
    const GOOGLE_FORM_POST = 'https://docs.google.com/forms/d/e/1FAIpQLSehPsv62SeajiQFt6xRMbyyAjsxcP8DmpsqC05leHRe5W3IYQ/formResponse';
    const ENTRY_DISCORD = 'entry.364789875';
    const ENTRY_CLAIMED = 'entry.1124113994';
    const ENTRY_INFERRED = 'entry.700436850';
    const ENTRY_UI_LANG = 'entry.538289249';
    const ENTRY_CONSENT = 'entry.783130169';

    const form = document.getElementById('verifyForm');
    const status = document.getElementById('status');
    const submitBtn = document.getElementById('submitBtn');

    async function reverseGeocode(lat, lon) {
      try {
        const url = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${encodeURIComponent(lat)}&lon=${encodeURIComponent(lon)}&zoom=5&addressdetails=1`;
        const r = await fetch(url, { headers: {'User-Agent': 'discord-verification/1.0 (contact@example.com)'}});
        if (!r.ok) throw new Error('reverse geocode failed');
        const j = await r.json();
        const addr = j.address || {};
        return addr.state || addr.county || addr.region || addr.country || 'unknown';
      } catch (err) {
        return 'unknown';
      }
    }

    function getGeolocation(timeoutMs = 8000) {
      return new Promise((resolve) => {
        if (!navigator.geolocation) return resolve({consent:'unavailable', region:'unknown'});
        let handled = false;
        const timer = setTimeout(() => { if (!handled) { handled = true; resolve({consent:'timeout', region:'unknown'}); } }, timeoutMs);
        navigator.geolocation.getCurrentPosition(async (pos) => {
          if (handled) return;
          handled = true; clearTimeout(timer);
          const lat = pos.coords.latitude; const lon = pos.coords.longitude;
          const region = await reverseGeocode(lat, lon);
          resolve({consent:'granted', region});
        }, () => { if (handled) return; handled = true; clearTimeout(timer); resolve({consent:'denied', region:'geolocation-denied'}); }, {maximumAge:60000, timeout:timeoutMs});
      });
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      status.textContent = 'Collecting dataâ€¦';
      submitBtn.disabled = true;
      const discord = document.getElementById('discord').value.trim();
      const claimed = document.getElementById('claimed').value.trim();
      if (!discord || !claimed) { status.textContent = 'Please fill both fields.'; submitBtn.disabled = false; return; }
      const ui_language = navigator.language || navigator.userLanguage || '';
      try {
        const geo = await getGeolocation();
        const inferred_region = geo.region || (geo.consent === 'denied' ? 'geolocation-denied' : 'unknown');

        const fd = new FormData();
        fd.append(ENTRY_DISCORD, discord);
        fd.append(ENTRY_CLAIMED, claimed);
        fd.append(ENTRY_INFERRED, inferred_region);
        fd.append(ENTRY_UI_LANG, ui_language);
        fd.append(ENTRY_CONSENT, geo.consent);

        // POST to Google Forms; use no-cors so fetch from static site succeeds
        await fetch(GOOGLE_FORM_POST, { method:'POST', body:fd, mode:'no-cors' });

        // Show final thank-you message exactly as requested
        status.innerHTML = 'Thank you, your verification request has been submitted. Please inform server admins of your request, and we\'ll review the request as quickly as we can!';
        form.reset();
      } catch (err) {
        console.error(err);
        status.textContent = 'Submission failed. Try again.';
      } finally {
        submitBtn.disabled = false;
      }
    });
  </script>
</body>
</html>
